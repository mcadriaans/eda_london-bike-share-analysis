<!DOCTYPE html>
<html>
<head>
<title>SQL_Exploratory_Analysis</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
<a href="index.html" class="back-button">‚Üê Back to Home</a>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="london-bike-sharing-eda-%F0%9F%9A%B2">London bike sharing EDA üö≤</h1>
<h2 id="create-table">Create table</h2>
<pre class="hljs"><code><div><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> bike_sharing (
    <span class="hljs-built_in">timestamp</span> <span class="hljs-built_in">TIMESTAMP</span>,
    cnt <span class="hljs-built_in">INTEGER</span>,
    t1 <span class="hljs-built_in">FLOAT</span>,
    t2 <span class="hljs-built_in">FLOAT</span>,
    wind_speed <span class="hljs-built_in">FLOAT</span>,
    weather_code <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">30</span>),
    is_holiday <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">5</span>),
    is_weekend <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">5</span>),
    season <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">25</span>),
	humidity_percent <span class="hljs-built_in">FLOAT</span>
);
</div></code></pre>
<h3 id="verify-table-exists-in-postgresql">Verify table exists in PostgreSQL</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span> * 
<span class="hljs-keyword">FROM</span> bike_sharing
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">5</span>;
<img src="https://github.com/user-attachments/assets/5a300dfb-0714-424a-9e5b-871bcbfc1e52" alt="SQL table output" style="max-width: 100%; border-radius: 6px; margin: 20px 0;">	
</div></code></pre>
<h2 id="business-questions">Business Questions</h2>
<h3 id="1-what-is-the-start-and-end-date-and-duration-of-bike-rental-tracking-in-our-data">1. What is the start and end date and duration of bike rental tracking in our data?</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span>
 <span class="hljs-keyword">MIN</span>(<span class="hljs-built_in">timestamp</span> :: <span class="hljs-built_in">DATE</span>) <span class="hljs-keyword">AS</span> starting_date,
 <span class="hljs-keyword">MAX</span>(<span class="hljs-built_in">timestamp</span> :: <span class="hljs-built_in">DATE</span>) <span class="hljs-keyword">AS</span> end_date,
 (<span class="hljs-keyword">MAX</span>(<span class="hljs-built_in">timestamp</span> :: <span class="hljs-built_in">DATE</span>) - <span class="hljs-keyword">MIN</span>(<span class="hljs-built_in">timestamp</span> :: <span class="hljs-built_in">DATE</span>)) <span class="hljs-keyword">AS</span> days_tracked
<span class="hljs-keyword">FROM</span> bike_sharing;
</div></code></pre>
<p><i><b>Insight</b>: The dataset encompasses a full two-year period, from January 4, 2015, to January 3, 2017, providing 730 days of data. This comprehensive timeframe is robust enough to identify and analyze daily, weekly, and seasonal ridership patterns with confidence.</i></p>
<h3 id="2-what-is-the-total-amount-of-bike-rentals-during-the-730-days">2. What is the total amount of bike rentals during the 730 days?</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span>
 <span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">AS</span> total_bike_rentals
<span class="hljs-keyword">FROM</span> bike_sharing;
</div></code></pre>
<p><i><b>Insight</b>: Over the two-year period, nearly 20 million bike rentals were recorded. This substantial volume underscores the service's significance as a major component of London's public transport system and highlights the scale of the operational challenge.</i></p>
<h4 id="21-what-is-the-total-amount-of-bike-rentals-per-year">2.1 What is the total amount of bike rentals per year?</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span>
 <span class="hljs-keyword">EXTRACT</span>(<span class="hljs-keyword">Year</span> <span class="hljs-keyword">FROM</span> <span class="hljs-built_in">timestamp</span>) <span class="hljs-keyword">AS</span> bs_year,
 <span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">AS</span> bike_rentals_per_year
<span class="hljs-keyword">FROM</span> bike_sharing
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>;
</div></code></pre>
<p><i><b>Insight</b>: The analysis shows a positive year-over-year growth in ridership from 2015 to 2016. The low rental count for 2017 is expected, as the dataset only includes the first three days of that year and does not represent a full year's performance.</i></p>
<h3 id="3-what-are-the-top-5-days-with-the-highest-number-of-bike-rentals">3. What are the top 5 days with the highest number of bike rentals?</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span>
 <span class="hljs-built_in">timestamp</span> :: <span class="hljs-built_in">DATE</span>,
 TO_CHAR(<span class="hljs-built_in">timestamp</span> :: <span class="hljs-built_in">DATE</span>, <span class="hljs-string">'Day'</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">weekday</span>,
 <span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">AS</span> daily_bike_rentals
<span class="hljs-keyword">FROM</span> bike_sharing
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">3</span> <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">5</span>;
</div></code></pre>
<p><i><b>Insight</b>: The days with the highest rental counts are concentrated in the peak summer month of July. This strongly suggests that a combination of factors‚Äîwarm weather, longer daylight hours, and potentially public events or holidays‚Äîcreates days with exceptionally high demand. The top day, July 9th, 2015, saw over 72,000 rentals, serving as a benchmark for maximum operational capacity.</i></p>
<h3 id="4-what-was-the-most-popular-season-for-bike-rentals-in-each-year">4. What was the most popular season for bike rentals in each year?</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span>
 bs_year,
 season,
 bike_rentals_per_year
<span class="hljs-keyword">FROM</span>(
 <span class="hljs-keyword">SELECT</span>
  <span class="hljs-keyword">EXTRACT</span>(<span class="hljs-keyword">Year</span> <span class="hljs-keyword">FROM</span> <span class="hljs-built_in">timestamp</span>) <span class="hljs-keyword">AS</span> bs_year,
  season,
  <span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">AS</span> bike_rentals_per_year,
  <span class="hljs-keyword">RANK</span>()<span class="hljs-keyword">OVER</span>(
    <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">EXTRACT</span>(<span class="hljs-keyword">Year</span> <span class="hljs-keyword">FROM</span> <span class="hljs-built_in">timestamp</span>)
    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">DESC</span>
  ) <span class="hljs-keyword">AS</span> rnk
  <span class="hljs-keyword">FROM</span> bike_sharing
  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>
)
<span class="hljs-keyword">WHERE</span> rnk = <span class="hljs-number">1</span>;
</div></code></pre>
<p><i><b>Insight</b>: Summer was consistently the most popular season for bike rentals in both full years of data (2015 and 2016), reinforcing the strong link between warmer weather and higher ridership. The result for 2017 reflects only the first few days of January, which fall in winter.</i></p>
<h3 id="5-show-the-minimum-average-and-maximum-actual-daily-temperatures">5. Show the minimum, average and maximum actual daily temperatures.</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span>
	<span class="hljs-built_in">timestamp</span>::<span class="hljs-built_in">DATE</span> <span class="hljs-keyword">AS</span> bs_date,
	<span class="hljs-keyword">MIN</span>(t1) <span class="hljs-keyword">AS</span> min_daily_temp,
	<span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">AVG</span>(t1):: <span class="hljs-built_in">NUMERIC</span>, <span class="hljs-number">1</span>) <span class="hljs-keyword">AS</span> avg_daily_temp,
	<span class="hljs-keyword">MAX</span>(t1) <span class="hljs-keyword">AS</span> max_daily_temp
<span class="hljs-keyword">FROM</span> bike_sharing
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>;
</div></code></pre>
<p><i><b>Insight</b>:  This query transforms the hourly data into a daily summary of temperature ranges. This aggregated view is essential for analyzing macro trends, as it allows us to correlate overall daily rental volumes with average temperatures and understand the impact of temperature fluctuations throughout a single day.</i></p>
<h3 id="6-what-are-the-humidity-levels-at-which-the-maximum-and-minimum-number-of-bike-rentals-occurred">6. What are the humidity levels at which the maximum and minimum number of bike rentals occurred?</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">WITH</span> rental_count_humidity <span class="hljs-keyword">AS</span> (
 <span class="hljs-keyword">SELECT</span> 
  humidity_percent,
  <span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">AS</span> total_bike_rentals
 <span class="hljs-keyword">FROM</span> bike_sharing
 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>
)

<span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> rental_count_humidity
<span class="hljs-keyword">WHERE</span> total_bike_rentals <span class="hljs-keyword">IN</span> (
 <span class="hljs-keyword">SELECT</span> 
  <span class="hljs-keyword">MAX</span>(total_bike_rentals) <span class="hljs-keyword">AS</span> max_rentals
 <span class="hljs-keyword">FROM</span> rental_count_humidity
 <span class="hljs-keyword">UNION</span>
 <span class="hljs-keyword">SELECT</span>
  <span class="hljs-keyword">MIN</span> (total_bike_rentals) <span class="hljs-keyword">AS</span> min_rentals
 <span class="hljs-keyword">FROM</span> rental_count_humidity);
</div></code></pre>
<p><i><b>Insight</b>: This query reveals an interesting paradox: both the highest and lowest total rental volumes occurred at very high humidity levels (82% and 88.5%, respectively). This suggests that while extreme humidity can be a deterrent, it is not the sole factor. The day with the highest volume (758k rentals at 82% humidity) was likely driven by other powerful factors like ideal temperature and a special event, which were strong enough to overcome the discomfort of the high humidity.</i></p>
<h3 id="7-find-the-7-day-moving-average-for-total-bike-rentals">7. Find the 7-day moving average for total bike rentals</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">WITH</span> daily_rentals <span class="hljs-keyword">AS</span>(
<span class="hljs-keyword">SELECT</span>
 <span class="hljs-built_in">timestamp</span> :: <span class="hljs-built_in">DATE</span> <span class="hljs-keyword">AS</span> bs_date,
 <span class="hljs-keyword">SUM</span>(cnt) <span class="hljs-keyword">AS</span> total_bike_rentals
<span class="hljs-keyword">FROM</span> bike_sharing
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>
)
<span class="hljs-keyword">SELECT</span>
 bs_date,
 total_bike_rentals,
 <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> ROW_NUMBER()<span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> bs_date) &lt; <span class="hljs-number">7</span> <span class="hljs-keyword">THEN</span> <span class="hljs-literal">NULL</span>
 <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">AVG</span>(total_bike_rentals) <span class="hljs-keyword">OVER</span>(
  <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> bs_date
  <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">6</span> <span class="hljs-keyword">PRECEDING</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">CURRENT</span> <span class="hljs-keyword">ROW</span>
  ), <span class="hljs-number">2</span>) <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> seven_day_moving_avg
<span class="hljs-keyword">FROM</span> daily_rentals
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>;
</div></code></pre>
<p><i><b>Insight</b>: By calculating a 7-day moving average, we can smooth out daily fluctuations and better identify the underlying weekly trends in ridership. This technique is crucial for distinguishing genuine shifts in demand from random daily noise, enabling more accurate medium-term forecasting and resource planning.</i></p>
<h3 id="8-how-do-weekends-and-holidays-influence-bike-rental-volumes-compared-to-weekdays">8. How do weekends and holidays influence bike rental volumes compared to weekdays?</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">WITH</span> day_type_rental_counts <span class="hljs-keyword">AS</span> (
 <span class="hljs-keyword">SELECT</span> 
  <span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> is_weekend = <span class="hljs-string">'yes'</span> <span class="hljs-keyword">THEN</span> cnt <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> weekend_rentals,
  <span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> is_holiday = <span class="hljs-string">'yes'</span> <span class="hljs-keyword">THEN</span> cnt <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> holiday_rentals,
  <span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> is_weekend = <span class="hljs-string">'no'</span> <span class="hljs-keyword">AND</span> is_holiday = <span class="hljs-string">'no'</span> <span class="hljs-keyword">THEN</span> cnt <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> weekday_rentals,
  <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> DATE_TRUNC(<span class="hljs-string">'day'</span>, <span class="hljs-built_in">timestamp</span>))FILTER(<span class="hljs-keyword">WHERE</span> is_weekend = <span class="hljs-string">'yes'</span>) <span class="hljs-keyword">AS</span> weekend_days,
  <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> DATE_TRUNC(<span class="hljs-string">'day'</span>, <span class="hljs-built_in">timestamp</span>))FILTER(<span class="hljs-keyword">WHERE</span> is_holiday = <span class="hljs-string">'yes'</span>) <span class="hljs-keyword">AS</span> holiday_days,
  <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> DATE_TRUNC(<span class="hljs-string">'day'</span>, <span class="hljs-built_in">timestamp</span>))FILTER(<span class="hljs-keyword">WHERE</span> is_weekend = <span class="hljs-string">'no'</span> <span class="hljs-keyword">AND</span> is_holiday = <span class="hljs-string">'no'</span>) <span class="hljs-keyword">AS</span> weekday_days
 <span class="hljs-keyword">FROM</span> bike_sharing
)

<span class="hljs-keyword">SELECT</span> 
 weekend_rentals / weekend_days <span class="hljs-keyword">AS</span> avg_weekend_daily_rentals,
 holiday_rentals / holiday_days <span class="hljs-keyword">AS</span> avg_holiday_daily_rentals,
 weekday_rentals / weekday_days <span class="hljs-keyword">AS</span> avg_weekday_daily_rentals
<span class="hljs-keyword">FROM</span> day_type_rental_counts;
</div></code></pre>
<p><i><b>Insight</b>: On an average day, weekday rental volume (29,213) is significantly higher than on weekends (23,242) and holidays (18,468). This quantifies the usage difference, showing that an average weekday is approximately 26% busier than an average weekend day, confirming that the service is driven primarily by commuting rather than leisure activities.</i></p>
<h3 id="9-write-a-query-to-classify-the-days-into-%22high-traffic%22-if-cnt--90th-percentile-%22medium-traffic%22-between-50th-and-90th-percentile-and-%22low-traffic%22-below-the-50th-percentilewhat-percentage-of-the-dataset-falls-in-the-high-traffic-category">9. Write a query to classify the days into &quot;High Traffic&quot; (if cnt &gt; 90th percentile), &quot;Medium Traffic&quot; (between 50th and 90th percentile), and &quot;Low Traffic&quot; (below the 50th percentile).What percentage of the dataset falls in the high traffic category?</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">WITH</span> percentile <span class="hljs-keyword">AS</span> (
  <span class="hljs-keyword">SELECT</span> 
    <span class="hljs-keyword">PERCENTILE_CONT</span>(<span class="hljs-number">0.50</span>) <span class="hljs-keyword">WITHIN</span> <span class="hljs-keyword">GROUP</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> cnt) <span class="hljs-keyword">AS</span> pctile_50,
    <span class="hljs-keyword">PERCENTILE_CONT</span>(<span class="hljs-number">0.90</span>) <span class="hljs-keyword">WITHIN</span> <span class="hljs-keyword">GROUP</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> cnt) <span class="hljs-keyword">AS</span> pctile_90
  <span class="hljs-keyword">FROM</span> bike_sharing
)
<span class="hljs-keyword">SELECT</span> 
 <span class="hljs-keyword">ROUND</span>(
   (<span class="hljs-keyword">SELECT</span> 
     <span class="hljs-keyword">COUNT</span>(*) 
   <span class="hljs-keyword">FROM</span> (
     <span class="hljs-keyword">SELECT</span>
       <span class="hljs-built_in">timestamp</span> :: <span class="hljs-built_in">date</span> <span class="hljs-keyword">AS</span> dt,
       cnt,
       <span class="hljs-keyword">CASE</span>
         <span class="hljs-keyword">WHEN</span> cnt &gt; (<span class="hljs-keyword">SELECT</span> pctile_90 <span class="hljs-keyword">FROM</span> percentile) <span class="hljs-keyword">THEN</span> <span class="hljs-string">'High Traffic'</span>
         <span class="hljs-keyword">WHEN</span> cnt &lt;= (<span class="hljs-keyword">SELECT</span> pctile_50 <span class="hljs-keyword">FROM</span> percentile) <span class="hljs-keyword">THEN</span> <span class="hljs-string">'Low Traffic'</span>
         <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'Medium Traffic'</span>
       <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> traffic_lvl
       <span class="hljs-keyword">FROM</span> bike_sharing
       ) <span class="hljs-keyword">AS</span> traffic_data
       <span class="hljs-keyword">WHERE</span> traffic_lvl = <span class="hljs-string">'High Traffic'</span>)::<span class="hljs-built_in">numeric</span> / (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">FROM</span> bike_sharing)::<span class="hljs-built_in">numeric</span> * <span class="hljs-number">100</span>, <span class="hljs-number">3</span>) <span class="hljs-keyword">AS</span> high_traffic_percentage;
</div></code></pre>
<p><i><b>Insight</b>: By segmenting hourly data into traffic tiers based on rental volume percentiles, we find that only the top 10% of hours qualify as &quot;High Traffic.&quot; This confirms that peak demand is highly concentrated in specific, predictable periods (like commuter rush hours), making it crucial to focus operational resources on these critical windows to maximize service availability and revenue. </i></p>
</body>
</html>
